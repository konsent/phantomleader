<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOP 갤러리</title>
    <style>
        /* --- 기본 & 레이아웃 스타일 --- */
        :root {
            --bg-color: #121212;
            --card-bg-color: #1e1e1e;
            --text-color: #e0e0e0;
            --arrow-bg-color: rgba(0, 0, 0, 0.5);
            --arrow-hover-bg-color: rgba(0, 0, 0, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column; /* 콘텐츠를 세로로 정렬 */
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden; /* 스크롤 방지 */
            padding: 20px 0; /* 위아래 최소 여백 확보 */
        }

        /* --- 슬라이더 컨테이너 --- */
        .slider-container {
            position: relative;
            width: 90vw;
            max-width: 850px; /* 데스크탑 카드 크기 확대 */
            aspect-ratio: 4 / 3;
            overflow: hidden;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            -webkit-user-select: none; /* 드래그 시 텍스트 선택 방지 */
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* --- 슬라이드 래퍼 (모든 이미지를 감싸는 요소) --- */
        .slides-wrapper {
            display: flex;
            height: 100%;
            /* transition 효과는 JS에서 동적으로 추가/제거 */
        }

        /* --- 개별 슬라이드 (카드) --- */
        .slide {
            flex: 0 0 100%; /* 각 슬라이드가 컨테이너 너비를 100% 차지 */
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--card-bg-color);
            padding: 50px; /* 이미지 주위 여백 대폭 추가 */
        }

        .slide img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* 이미지 비율을 유지하며 카드에 맞춤 */
        }

        /* --- 네비게이션 버튼 (데스크탑용) --- */
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--arrow-bg-color);
            color: white;
            border: none;
            padding: 15px;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            z-index: 10;
            transition: background-color 0.3s ease;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-arrow:hover {
            background-color: var(--arrow-hover-bg-color);
        }

        .prev {
            left: 15px;
        }

        .next {
            right: 15px;
        }

        /* --- 페이지 표시기 --- */
        .pagination {
            position: absolute; /* 슬라이더 내부에 위치 */
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: rgba(0, 0, 0, 0.4);
            padding: 6px 12px;
            border-radius: 25px;
            font-size: 14px;
            color: #888; /* 텍스트 색상 변경 */
            font-weight: 500;
            z-index: 10;
        }

        #reset-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;
            transition: color 0.2s;
        }

        #reset-btn:hover {
            color: white;
        }

        /* --- 모바일 환경에서는 화살표 숨기기 --- */
        @media (max-width: 768px) {
            .nav-arrow {
                display: none;
            }
            .slider-container {
                width: 100vw;
                height: 65vh; /* 슬라이더 크기 증가 */
                border-radius: 0;
            }
        }
    </style>
</head>
<body>

    <div class="slider-container">
        <div class="slides-wrapper">
            <!-- 이미지는 JavaScript로 동적으로 생성됩니다. -->
        </div>

        <!-- 데스크탑용 네비게이션 버튼 -->
        <button class="nav-arrow prev">&#10094;</button>
        <button class="nav-arrow next">&#10095;</button>

        <!-- 페이지 번호 및 리셋 버튼 -->
        <div class="pagination">
            <button id="reset-btn" title="처음으로 돌아가기">&#x21BB;</button>
            <span class="page-indicator">
                <span id="current-page">1</span> / <span id="total-pages">30</span>
            </span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const slidesWrapper = document.querySelector('.slides-wrapper');
            const prevBtn = document.querySelector('.prev');
            const nextBtn = document.querySelector('.next');
            const sliderContainer = document.querySelector('.slider-container');
            const currentPageEl = document.getElementById('current-page');
            const totalPagesEl = document.getElementById('total-pages');
            const resetBtn = document.getElementById('reset-btn');

            const TOTAL_SLIDES = 30;
            let currentIndex = 0;
            let isDragging = false;
            let startPos = 0;
            let currentTranslate = 0;
            let prevTranslate = 0;

            // 1. 이미지 동적 생성
            function createImageSlides() {
                for (let i = 1; i <= TOTAL_SLIDES; i++) {
                    const slide = document.createElement('div');
                    slide.classList.add('slide');

                    const img = document.createElement('img');
                    // 파일 이름이 01, 02, ... 형태이므로 padStart로 2자리 수를 맞춥니다.
                    const imgNumber = String(i).padStart(2, '0');
                    img.src = `./assets/sop/${imgNumber}.png`;
                    img.alt = `SOP 이미지 ${i}`;
                    // 이미지 드래그 방지
                    img.addEventListener('dragstart', (e) => e.preventDefault());

                    slide.appendChild(img);
                    slidesWrapper.appendChild(slide);
                }
                totalPagesEl.textContent = TOTAL_SLIDES;
                updateSliderPosition();
            }

            // 2. 슬라이더 위치 업데이트
            function updateSliderPosition() {
                slidesWrapper.style.transform = `translateX(${currentTranslate}px)`;
                currentPageEl.textContent = currentIndex + 1;
            }
            
            // 3. 부드러운 이동을 위한 애니메이션 설정
            function setPositionWithAnimation() {
                slidesWrapper.style.transition = 'transform 0.4s ease-out';
                updateSliderPosition();
            }

            // 4. 다음/이전 슬라이드로 이동
            function showNextSlide() {
                if (currentIndex < TOTAL_SLIDES - 1) {
                    currentIndex++;
                    currentTranslate = -currentIndex * sliderContainer.clientWidth;
                    setPositionWithAnimation();
                }
            }

            function showPrevSlide() {
                if (currentIndex > 0) {
                    currentIndex--;
                    currentTranslate = -currentIndex * sliderContainer.clientWidth;
                    setPositionWithAnimation();
                }
            }

            // 5. 데스크탑 버튼 이벤트 리스너
            nextBtn.addEventListener('click', showNextSlide);
            prevBtn.addEventListener('click', showPrevSlide);
            resetBtn.addEventListener('click', () => {
                if (currentIndex !== 0) {
                    currentIndex = 0;
                    currentTranslate = 0;
                    prevTranslate = 0;
                    setPositionWithAnimation();
                }
            });

            // 버튼 클릭 시 이벤트 버블링을 막아 드래그 이벤트와 중복 실행 방지
            [prevBtn, nextBtn].forEach(btn => {
                btn.addEventListener('mousedown', (e) => e.stopPropagation());
                btn.addEventListener('touchstart', (e) => e.stopPropagation());
                btn.addEventListener('mouseup', (e) => e.stopPropagation());
                btn.addEventListener('touchend', (e) => e.stopPropagation());
            });
            resetBtn.addEventListener('mousedown', (e) => e.stopPropagation());
            resetBtn.addEventListener('touchstart', (e) => {
                e.stopPropagation();
            });

            // 6. 키보드 화살표 키 이벤트 처리
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    showPrevSlide();
                } else if (e.key === 'ArrowRight') {
                    showNextSlide();
                }
            });

            // 6. 모바일 스와이프(터치) & 데스크탑 드래그(마우스) 이벤트 처리
            function touchStart(index) {
                return function(event) {
                    isDragging = true;
                    startPos = getPositionX(event);
                    // 애니메이션 효과를 잠시 제거하여 드래그가 부드럽게 보이게 함
                    slidesWrapper.style.transition = 'none';
                }
            }

            function touchMove(event) {
                if (isDragging) {
                    const currentPosition = getPositionX(event);
                    // 시작 위치에서 현재 위치까지의 차이만큼 이동
                    currentTranslate = prevTranslate + currentPosition - startPos;
                    updateSliderPosition();
                }
            }

            function touchEnd() {
                isDragging = false;
                const movedBy = currentTranslate - prevTranslate;

                // 50px 이상 움직였을 때만 슬라이드 넘김 처리
                if (movedBy < -50 && currentIndex < TOTAL_SLIDES - 1) {
                    currentIndex++;
                }
                if (movedBy > 50 && currentIndex > 0) {
                    currentIndex--;
                }

                // 최종 위치 계산 및 애니메이션과 함께 이동
                currentTranslate = -currentIndex * sliderContainer.clientWidth;
                prevTranslate = currentTranslate;
                setPositionWithAnimation();
            }

            function getPositionX(event) {
                return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
            }

            // 마우스 이벤트
            sliderContainer.addEventListener('mousedown', touchStart(0));
            sliderContainer.addEventListener('mouseup', touchEnd);
            sliderContainer.addEventListener('mouseleave', touchEnd);
            sliderContainer.addEventListener('mousemove', touchMove);

            // 터치 이벤트
            sliderContainer.addEventListener('touchstart', touchStart(0));
            sliderContainer.addEventListener('touchend', touchEnd);
            sliderContainer.addEventListener('touchmove', touchMove);
            
            // 창 크기가 변경될 때 슬라이더 위치 재계산
            window.addEventListener('resize', () => {
                currentTranslate = -currentIndex * sliderContainer.clientWidth;
                prevTranslate = currentTranslate;
                // 리사이즈 시에는 애니메이션 없이 바로 위치 조정
                slidesWrapper.style.transition = 'none';
                updateSliderPosition();
            });

            // 초기화 함수 호출
            createImageSlides();
        });
    </script>

</body>
</html>
